<?xml version="1.0" encoding="UTF-8"?>
<ipojo 
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="org.apache.felix.ipojo http://felix.apache.org/ipojo/schemas/CURRENT/core.xsd"
		xmlns="org.apache.felix.ipojo">

	<!-- A component for the DM -->
	<component classname="net.roboconf.dm.management.Manager" name="roboconf-dm" public="false">

		<requires optional="false" field="preferencesMngr" />
		<requires aggregate="true" optional="true">
			<callback type="bind" method="targetAppears" />
			<callback type="unbind" method="targetDisappears" />
		</requires>

		<requires aggregate="true" optional="true">
			<callback type="bind" method="listenerAppears" />
			<callback type="unbind" method="listenerDisappears" />
		</requires>

		<callback transition="validate" method="start" />
		<callback transition="invalidate" method="stop" />

		<provides specifications="net.roboconf.core.runtime.IReconfigurable" />
		<provides specifications="net.roboconf.dm.management.Manager" />

		<properties pid="net.roboconf.dm.configuration">
			<property name="messaging-type" method="setMessagingType" />
			<property name="domain" method="setDomain" />
		</properties>
	</component>
	
	<!-- A component for the preferences -->
	<!-- Preferences can be updated through files but might also be updated from the web console -->
	<component classname="net.roboconf.dm.internal.api.impl.PreferencesMngrImpl" name="roboconf-dm-preferences" public="false">
		<callback transition="validate" method="start" />
		<callback transition="invalidate" method="stop" />

		<provides specifications="net.roboconf.dm.management.api.IPreferencesMngr" />
		<properties pid="net.roboconf.dm.preferences" updated="updateProperties" propagation="true" />
		<requires field="configAdmin" optional="true" />
	</component>

	<!-- And the instances... -->
	<instance component="roboconf-dm" name="Roboconf - DM" />
	<instance component="roboconf-dm-preferences" name="Roboconf - DM Preferences" />
</ipojo>
